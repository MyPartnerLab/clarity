<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clarity Circle Checkout</title>

  <!-- Reset / grid -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
  <!-- Fonts / icons / Stripe -->
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://js.stripe.com/v3"></script>

  <style>
    :root {
      --brand-primary:#800f2f; --brand-accent:#c9184a;
      --radius:.75rem; --gap:2rem;
      --summary-bg:#f4e8de; --form-bg:#ffffff;
    }
    body{margin:0;padding:3rem 0;font-family:'Lato',sans-serif;background:#faf7f3;}

    /* ===== layout ===== */
    .checkout-wrapper{max-width:1100px;margin:0 auto;display:flex;gap:var(--gap);flex-wrap:nowrap;}
    .checkout-form   {flex:1 1 60%;background:var(--form-bg);border-radius:var(--radius);box-shadow:0 6px 16px rgba(0,0,0,.06);padding:2.25rem;}
    .checkout-summary{flex:1 1 40%;background:var(--summary-bg);border-radius:var(--radius);box-shadow:0 6px 16px rgba(0,0,0,.06);padding:2rem;display:flex;flex-direction:column;align-items:center;text-align:center;}
    @media(max-width:767px){.checkout-wrapper{flex-direction:column;}}

    /* ===== plan cards ===== */
    #plan-options{display:flex;gap:1rem;margin-bottom:1.25rem;}
    .plan-card{position:relative;flex:1;border:1px solid #d7d7d7;background:#fff;border-radius:var(--radius);padding:1.25rem 1.5rem;cursor:pointer;display:flex;flex-direction:column;justify-content:space-between;transition:.25s ease;box-shadow:0 2px 6px rgba(0,0,0,.05);}
    .plan-card:hover{box-shadow:0 6px 20px rgba(0,0,0,.08);}
    .plan-card.active{border-color:var(--brand-primary);box-shadow:0 0 0 3px rgba(128,15,47,.25);}
    .plan-title{font-weight:700;margin-bottom:.15rem;}
    .plan-sub{font-size:.82rem;font-style:italic;opacity:.75;}
    .price{align-self:flex-end;font-size:1.35rem;font-weight:700;color:var(--brand-primary);}
    /* corner ribbon -> only visible on active */
    .corner-tag{display:none;position:absolute;top:0;left:0;width:0;height:0;border-top:55px solid var(--brand-primary);border-right:55px solid transparent;border-top-left-radius:var(--radius);}
    .corner-tag i{position:absolute;top:-40px;left:10px;color:#fff;font-size:.8rem;}
    .plan-card.active .corner-tag{display:block;}

    /* ===== labels / inputs ===== */
    h3{font-size:1.05rem;font-weight:700;color:var(--brand-primary);margin:1.5rem 0 .75rem;}
    #card-element{border:1px solid #ccc;border-radius:var(--radius);padding:.75rem;}
    .payment-label{display:flex;justify-content:space-between;align-items:center;margin-top:.5rem;}
    .card-logos img{height:20px;margin-left:4px;}
    .logos-wrap{margin-bottom:.5rem;}       /* ← extra space between logos and Stripe box */
    #submit{margin-top:1.75rem;width:100%;background:var(--brand-primary);color:#fff;border:none;border-radius:var(--radius);padding:.85rem 1rem;font-weight:700;}
    #submit:hover{background:var(--brand-accent);}

    /* ===== summary section ===== */
    .summary-mockup{width:80%;max-width:260px;border-radius:var(--radius);box-shadow:0 4px 12px rgba(0,0,0,.1);margin-bottom:1rem;}
    .benefits{list-style:none;padding:0;margin:1rem 0;width:100%;}
    .benefits li{display:flex;margin-bottom:.55rem;font-size:.9rem;}
    .benefits li img{width:18px;margin-right:.45rem;}
    .benefits li span{margin-left:auto;opacity:.7;}
    hr{width:100%;border-top:1px solid rgba(0,0,0,.1);margin:1rem 0;}
    .summary-meta{font-style:italic;opacity:.75;}
  </style>
</head>
<body>
  <div class="checkout-wrapper">

    <!-- ===== form ===== -->
    <form class="checkout-form" id="checkout-form">

      <!-- plan selector -->
      <div id="plan-options">
        <div class="plan-card active" data-plan="lifetime" data-amount="9700" data-desc="Clarity Circle – Founding Member Plan (lifetime access)">
          <span class="corner-tag"><i class="fas fa-check"></i></span>
          <div>
            <span class="plan-title">Founding Member Plan</span>
            <span class="plan-sub">One‑time payment of $97</span>
          </div>
          <span class="price">$97</span>
        </div>

        <div class="plan-card" data-plan="monthly" data-amount="1700" data-desc="Clarity Circle – Monthly Plan (monthly)">
          <span class="corner-tag"><i class="fas fa-check"></i></span>
          <div>
            <span class="plan-title">Monthly Plan</span>
            <span class="plan-sub">$17 per month, cancel anytime</span>
          </div>
          <span class="price">$17</span>
        </div>
      </div>

      <!-- contact info -->
      <h3>Contact Information</h3>
      <div class="form-row">
        <div class="col">
          <label>First Name</label>
          <input id="firstName" type="text" class="form-control" required />
        </div>
        <div class="col">
          <label>Last Name</label>
          <input id="lastName" type="text" class="form-control" required />
        </div>
      </div>
      <label>Email</label>
      <input id="email" type="email" class="form-control" required />

      <!-- card -->
      <h3>Credit/Debit Card</h3>
      <div class="payment-label logos-wrap">
        <label class="m-0">Accepted cards</label>
        <div class="card-logos">
          <img src="img/visa_creditcard.png" alt="Visa">
          <img src="img/mastercard_creditcard.png" alt="Mastercard">
          <img src="img/amex_creditcard.png" alt="AmEx">
          <img src="img/discover_creditcard.png" alt="Discover">
        </div>
      </div>
      <div id="card-element"></div>

      <button id="submit" type="submit">Secure My Spot</button>
      <p class="text-center mt-2" style="font-size:.8rem;color:#666">
        <i class="fas fa-lock"></i> Payments secured with 256‑bit SSL • PCI‑DSS Level 1
      </p>
    </form>

    <!-- ===== summary ===== -->
    <aside class="checkout-summary">
      <img src="img/mockup1.png" class="summary-mockup" alt="Preview">

      <h2>Join the Clarity Circle</h2>
      <ul class="benefits">
        <li><img src="img/checkmark.svg">Research‑Backed Tools<span>($997+)</span></li>
        <li><img src="img/checkmark.svg">Unlimited Checkups<span>($300+)</span></li>
        <li><img src="img/checkmark.svg">Private Community<span>($497)</span></li>
        <li><img src="img/checkmark.svg">Live Q&amp;A Sessions<span>($997+)</span></li>
        <li><img src="img/checkmark.svg">Lifetime Access<span>(priceless)</span></li>
        <li><img src="img/checkmark.svg">30‑Day Refund Policy</li>
        <li><img src="img/checkmark.svg">Cancel anytime</li>
      </ul>

      <hr>
      <p id="summary-desc" style="font-weight:600">Clarity Circle – Founding Member Plan <em>(lifetime access)</em></p>
      <p class="summary-meta">Total Value: $2500+</p>
      <p style="margin-top:1rem"><strong>Due Today:</strong> <span id="due-today">$97</span></p>
    </aside>
  </div>

  <!-- ===== Stripe + logic ===== -->
  <script>
    const stripe = Stripe('pk_test_51REdLuE8SHAdzYaCRQaHpLF10cTJq1FWcg5P39UAzp2W4tWUJ8S2BlWrqH6x7lYJIBhNnzkga48YObl5HphE9eBT001D6w1Oev');
    const elements = stripe.elements();
    elements.create('card').mount('#card-element');

    let selectedPlan = { plan:'lifetime', amount:9700, desc:'Clarity Circle – Founding Member Plan (lifetime access)' };

    document.querySelectorAll('.plan-card').forEach(card=>{
      card.addEventListener('click',()=>{
        document.querySelectorAll('.plan-card').forEach(c=>c.classList.remove('active'));
        card.classList.add('active');
        selectedPlan = { plan:card.dataset.plan, amount:+card.dataset.amount, desc:card.dataset.desc };
        document.getElementById('summary-desc').innerHTML = selectedPlan.desc.replace('(', '(<em>').replace(')', '</em>');
        document.getElementById('due-today').textContent = `$${(selectedPlan.amount/100).toFixed(0)}`;
        document.getElementById('submit').textContent = selectedPlan.plan==='lifetime' ? 'Secure My Spot' : 'Start My Monthly Plan';
      });
    });

    document.getElementById('checkout-form').addEventListener('submit',async e=>{
      e.preventDefault(); document.getElementById('submit').disabled=true;
      const res = await fetch('/api/create-payment-intent',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({plan:selectedPlan.plan,amount:selectedPlan.amount,email:email.value,firstName:firstName.value})});
      const { clientSecret,error:beErr } = await res.json();
      if(beErr){ alert(beErr); document.getElementById('submit').disabled=false; return; }
      const { error } = await stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement('card'),billing_details:{name:`${firstName.value} ${lastName.value}`,email:email.value}}});
      if(error){ alert(error.message); document.getElementById('submit').disabled=false; } else { window.location='/thank-you'; }
    });
  </script>
</body>
</html>
