<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clarity Circle Checkout</title>
  <meta name="description" content="Join The Clarity Circle — one‑time $97 or $17/mo" />

  <!-- Bootstrap, Fonts & Stripe.js -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://js.stripe.com/v3"></script>

  <style>
    :root {
      --brand: #800f2f;
      --accent: #c9184a;
      --radius: 0.75rem;
      --gap: 1.5rem;
      --bg-light: #faf7f3;
      --bg-form: #fff;
      --bg-summary: #f4e8de;
    }
    body {
      margin: 0;
      padding: 3rem 0;
      font-family: 'Lato', sans-serif;
      background: var(--bg-light);
    }
    .checkout-wrapper {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      gap: var(--gap);
    }
    @media (max-width: 767px) {
      .checkout-wrapper { flex-direction: column; }
    }

    /* Form */
    .checkout-form {
      flex: 0 0 60%;
      background: var(--bg-form);
      border-radius: var(--radius);
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
      padding: 2rem;
    }
    #plan-options {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .plan-input { display: none; }
    .plan-card {
      flex: 1;
      border: 1px solid #d7d7d7;
      border-radius: var(--radius);
      background: #fff;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: box-shadow .25s, border-color .25s, background .25s;
    }
    .plan-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
    .plan-input:checked + .plan-card {
      border-color: var(--brand);
      background: #fffdf8;
      box-shadow: 0 0 0 3px rgba(128,15,47,0.15);
    }
    .plan-badge {
      display: inline-block;
      background: var(--brand);
      color: #fff;
      padding: .25rem .5rem;
      border-radius: 999px;
      font-size: .75rem;
      font-weight: 700;
      margin-bottom: .5rem;
    }
    .plan-title { font-weight:700; margin: .25rem 0; }
    .plan-sub { font-style:italic; opacity:.75; font-size:.85rem; }
    .price { font-size:1.3rem; color:var(--brand); margin-top:.5rem; }
    .form-control { border-radius:var(--radius); padding:.75rem 1rem; margin-bottom:1rem; }
    #card-element {
      border:1px solid #ccc;
      border-radius:var(--radius);
      padding:1rem;
    }
    #card-errors { color:#dc3545; margin-top:.5rem; }

    /* Submit */
    #submit {
      width:100%;
      margin-top:2rem;
      background:var(--brand);
      color:#fff;
      border:none;
      border-radius:var(--radius);
      padding:1rem;
      font-weight:700;
      transition:background .25s;
    }
    #submit:hover { background:var(--accent); }

    /* Summary */
    .checkout-summary {
      flex:0 0 40%;
      text-align:center;
    }
    .summary-box {
      background:var(--bg-summary);
      border-radius:var(--radius);
      box-shadow:0 6px 16px rgba(0,0,0,0.06);
      padding:2rem;
      margin-top:1rem;
    }
    .summary-box h2 { margin-bottom:1rem; color:var(--brand); }
    .benefits { list-style:none; padding:0; text-align:left; margin:0 0 1rem; }
    .benefits li { display:flex; justify-content:space-between; margin-bottom:.5rem; }
    .order-total {
      display:flex;
      justify-content:space-between;
      font-weight:700;
      color:var(--brand);
    }
    .order-total span { color:var(--accent); }
    .terms { margin-top:1rem; }
  </style>
</head>
<body>

  <div class="checkout-wrapper">
    <form id="checkout-form" class="checkout-form" novalidate>
      <!-- Plan Selection -->
      <div id="plan-options">
        <input type="radio" id="plan-lifetime" name="plan" value="lifetime" class="plan-input" checked />
        <label for="plan-lifetime" class="plan-card">
          <span class="plan-badge">Founding Member Plan</span>
          <div class="plan-title">Lifetime Access</div>
          <div class="plan-sub">One‑time $97</div>
          <div class="price">$97 total</div>
        </label>

        <input type="radio" id="plan-monthly" name="plan" value="monthly" class="plan-input" />
        <label for="plan-monthly" class="plan-card">
          <span class="plan-badge">Founding Member Plan</span>
          <div class="plan-title">Monthly Access</div>
          <div class="plan-sub">$17/month</div>
          <div class="price">$17 / month</div>
        </label>
      </div>

      <!-- Contact Info -->
      <h3>Contact Info</h3>
      <div class="form-row row">
        <div class="col">
          <input type="text" id="firstName" class="form-control" placeholder="First Name" required />
        </div>
        <div class="col">
          <input type="text" id="lastName" class="form-control" placeholder="Last Name" required />
        </div>
      </div>
      <input type="email" id="email" class="form-control" placeholder="Email" required />

      <!-- Card Element -->
      <h3>Payment Details</h3>
      <div id="card-element"></div>
      <div id="card-errors" role="alert"></div>

      <!-- Terms -->
      <div class="terms">
        <input type="checkbox" id="agree" required />
        <label for="agree">
          I agree to the <a href="https://www.mypartnerlab.co/terms" target="_blank">terms & conditions</a>.
        </label>
      </div>

      <button id="submit" type="submit">Secure My Spot</button>
    </form>

    <div class="checkout-summary">
      <h2>Join the Clarity Circle</h2>
      <ul class="benefits">
        <li><span>Research‑Backed Tools</span><span>($997+)</span></li>
        <li><span>Unlimited Checkups</span><span>($300+)</span></li>
        <li><span>Community Access</span><span>($497)</span></li>
        <li><span>Live Q&A Sessions</span><span>($997+)</span></li>
        <li id="liLifetime"><span>Lifetime Access</span><span>—</span></li>
        <li id="liCancel"><span>Cancel anytime</span><span>—</span></li>
        <li><span>30‑Day Refund Policy</span><span>—</span></li>
      </ul>
      <div class="order-total">
        <strong>Your Total:</strong><span id="yourTotal"></span>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const stripe = Stripe('pk_test_51REdLuE8SHAdzYaCRQaHpLF10cTJq1FWcg5P39UAzp2W4tWUJ8S2BlWrqH6x7lYJIBhNnzkga48YObl5HphE9eBT001D6w1Oev');
    const elements = stripe.elements();
    const card = elements.create('card');
    card.mount('#card-element');

    let selectedPlan = 'lifetime';
    document.querySelectorAll('input[name="plan"]').forEach(radio =>
      radio.addEventListener('change', e => {
        selectedPlan = e.target.value;
        renderSummary(selectedPlan);
      })
    );
    renderSummary(selectedPlan);

    const form = document.getElementById('checkout-form');
    const errorDiv = document.getElementById('card-errors');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      errorDiv.textContent = '';
      if (!document.getElementById('agree').checked) {
        alert('You must agree to the terms.');
        return;
      }

      const firstName = document.getElementById('firstName').value.trim();
      const lastName  = document.getElementById('lastName').value.trim();
      const email     = document.getElementById('email').value.trim();

      const { paymentMethod, error: pmError } = await stripe.createPaymentMethod({
        type: 'card',
        card,
        billing_details: { name:`${firstName} ${lastName}`, email }
      });
      if (pmError) {
        errorDiv.textContent = pmError.message;
        return;
      }

      const res = await fetch('/.netlify/functions/create-payment-intent', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({
          plan: selectedPlan,
          paymentMethod: paymentMethod.id,
          firstName, lastName, email
        })
      });

      const data = await res.json();
      if (data.error) {
        errorDiv.textContent = data.error;
        return;
      }

      if (data.requiresAction) {
        const { error: confirmError } = await stripe.confirmCardPayment(data.clientSecret);
        if (confirmError) {
          errorDiv.textContent = confirmError.message;
          return;
        }
      }

      window.location.href = 'https://mypartnerlab.co/checkout-thank-you';
    });
  });

  function renderSummary(plan) {
    const isLifetime = plan === 'lifetime';
    document.getElementById('liLifetime').style.display = isLifetime ? 'flex' : 'none';
    document.getElementById('liCancel').style.display   = isLifetime ? 'none' : 'flex';
    document.getElementById('yourTotal').textContent    = isLifetime ? '$97.00' : '$17.00';
  }
  </script>
</body>
</html>
